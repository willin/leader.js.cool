__NUXT_JSONP__("/experience/operation/certbot", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){return {data:[{document:{slug:"certbot",description:"",title:"CertBot 证书",position:2207,category:"经验篇-运维",toc:[],body:{type:"root",children:[{type:b,tag:g,props:{},children:[{type:a,value:"在阿里云 ECS 上安装的话，Python 版本是包含 2、3 两个的，所以需要升级 pip 到 9.0 之后版本。"}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"如果是"},{type:b,tag:f,props:{},children:[{type:a,value:"Ubuntu 16.04"}]},{type:a,value:"版本，千万不要用"},{type:b,tag:f,props:{},children:[{type:a,value:"Root"}]},{type:a,value:"安装。"}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"升级过程中提示："}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,n]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"locale.Error: unsupported locale setting\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"通过修改本地语言修复："}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{className:[e,o,p]},children:[{type:a,value:q}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,s,t]},children:[{type:b,tag:d,props:{className:[e,"environment","constant"]},children:[{type:a,value:"LC_ALL"}]}]},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:v}]},{type:b,tag:d,props:{className:[e,w]},children:[{type:a,value:x}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,o,p]},children:[{type:a,value:q}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,s,t]},children:[{type:a,value:"LC_CTYPE"}]},{type:b,tag:d,props:{className:[e,u]},children:[{type:a,value:v}]},{type:b,tag:d,props:{className:[e,w]},children:[{type:a,value:x}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,m]},children:[{type:a,value:"sudo"}]},{type:a,value:" dpkg-reconfigure locales\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"然后一路回车结束。"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"pip "},{type:b,tag:d,props:{className:[e,m]},children:[{type:a,value:"install"}]},{type:a,value:" -U pip\n\n"},{type:b,tag:d,props:{className:[e,y]},children:[{type:a,value:"# 测试安装结果"}]},{type:a,value:"\npip -V\n"},{type:b,tag:d,props:{className:[e,y]},children:[{type:a,value:"# pip 9.0.1 from \u002Fusr\u002Flocal\u002Flib\u002Fpython2.7\u002Fdist-packages (python 2.7)"}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:"adsbygoogle",props:{},children:[{type:a,value:c}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"安装"},{type:b,tag:f,props:{},children:[{type:a,value:"certbot-auto"}]}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:b,tag:d,props:{className:[e,m]},children:[{type:a,value:"wget"}]},{type:a,value:" https:\u002F\u002Fdl.eff.org\u002Fcertbot-auto\n"},{type:b,tag:d,props:{className:[e,m]},children:[{type:a,value:"chmod"}]},{type:a,value:" +x certbot-auto\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"检查 Nginx 是否已经配置该网站。"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,n]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"server {\n        listen 80;\n        server_name example.com;\n        add_header Strict-Transport-Security max-age=15768000;\n        return 301 https:\u002F\u002Fexample.com$request_uri;\n}\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"颁发证书："}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:".\u002Fcertbot-auto certonly --agree-tos --email mail@example.com --nginx -d example.com\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"添加 HTTPS 配置："}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,n]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"server {\n        listen 443 ssl http2; # managed by Certbot\n        server_name example.com;\n        ssl_certificate \u002Fetc\u002Fletsencrypt\u002Flive\u002Fexample.com\u002Ffullchain.pem; # managed by Certbot\n        ssl_certificate_key \u002Fetc\u002Fletsencrypt\u002Flive\u002Fexample.com\u002Fprivkey.pem; # managed by Certbot\n        ssl_session_cache shared:le_nginx_SSL:1m; # managed by Certbot\n        ssl_session_timeout 1440m; # managed by Certbot\n\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # managed by Certbot\n        ssl_prefer_server_ciphers on; # managed by Certbot\n\n        ssl_ciphers \"ECDHE-ECDSA-AES128-GCM-SHA256 ECDHE-ECDSA-AES256-GCM-SHA384 ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-AES128-SHA256 ECDHE-ECDSA-AES256-SHA384 ECDHE-RSA-AES128-GCM-SHA256 ECDHE-RSA-AES256-GCM-SHA384 ECDHE-RSA-AES128-SHA ECDHE-RSA-AES128-SHA256 ECDHE-RSA-AES256-SHA384 DHE-RSA-AES128-GCM-SHA256 DHE-RSA-AES256-GCM-SHA384 DHE-RSA-AES128-SHA DHE-RSA-AES256-SHA DHE-RSA-AES128-SHA256 DHE-RSA-AES256-SHA256 EDH-RSA-DES-CBC3-SHA\"; # managed by Certbot\n\n        # add_header Alternate-Protocol  443:npn-spdy\u002F3;\n        add_header Strict-Transport-Security \"max-age=31536000;\";\n        #add_header  X-Content-Type-Options \"nosniff\";\n        #add_header X-Frame-Options DENY;\n\n        access_log off;\n\n        # 应用部分\n}\n"}]}]}]},{type:a,value:c},{type:b,tag:g,props:{},children:[{type:a,value:"更新证书命令："}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k,l]},children:[{type:b,tag:f,props:{},children:[{type:a,value:".\u002Fcertbot-auto renew --dry-run\n"}]}]}]}]},dir:"\u002Fzh\u002Fexperience\u002Foperation",path:"\u002Fzh\u002Fexperience\u002Foperation\u002Fcertbot",extension:".md",createdAt:z,updatedAt:z,to:"\u002Fexperience\u002Foperation\u002Fcertbot"},prev:{title:"版本回退",path:"\u002Fzh\u002Fexperience\u002Foperation\u002Frollback",to:"\u002Fexperience\u002Foperation\u002Frollback"},next:{title:"CloudFlare",path:"\u002Fzh\u002Fexperience\u002Foperation\u002Fcloudflare-nginx",to:"\u002Fexperience\u002Foperation\u002Fcloudflare-nginx"}}],fetch:{},mutations:[]}}("text","element","\n","span","token","code","p","div","nuxt-content-highlight","pre","line-numbers","language-bash","function","language-text","builtin","class-name","export"," ","assign-left","variable","operator","=","string","\"en_US.UTF-8\"","comment","2022-04-10T06:15:24.231Z")));